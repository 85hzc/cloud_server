var redis = require("redis");
var client = redis.createClient();
var commandId=1;
var cmdTimeOutSec=10;

client.on("error", function(err) {
  console.log("Error " + err);
});

/* cmd status:
 *              Start
 *              Success
 *              [ErrorStr]
 *              */
function create() {
    var newCmdId=commandId++
    client.set(newCmdId.toString(), 'Start');
    client.expire(newCmdId.toString(), cmdTimeOutSec);
    return newCmdId;
}

function update(cmdIdStr, newStatus) {
    client.set(cmdIdStr, newStatus);
    client.expire(cmdIdStr, cmdTimeOutSec);
}

function getRet(cmdIdStr, callback) {
    client.get(cmdIdStr, function(err, reply) {
        if(err) {
            console.log(err.stack);
        }
        // reply is null when the key is missing
        callback(reply);
    });
}

exports.create = create;
exports.update = update;
exports.getRet = getRet;
